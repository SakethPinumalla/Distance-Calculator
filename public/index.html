<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Distance Calculator</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Edu+AU+VIC+WA+NT+Hand:wght@400..700&family=Freeman&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Playwrite+AR:wght@100..400&family=Quicksand:wght@300..700&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h1 style="text-align: center;">Distance Calculator</h1>
    <form id="distanceForm">
      <div>
        <label for="startLocation">Start Location:</label>
        <input type="text" id="startLocation" required>
      </div>
      <div>
        <label for="endLocation">End Location:</label>
        <input type="text" id="endLocation" required>
      </div>
      <div>
        <label for="hqLocation">District Headquarters:</label>
        <input type="text" id="hqLocation" required>
      </div>
      <div style="display: flex; flex-direction: row;">
      <button type="button" id="getDistances">Get Distances</button>
      <button type="button" id="addToList">Add to List</button></div>
    </form>
  </div>

  <div class="table-container">
    <table id="locationTable">
      <thead>
        <tr>
          <th>S.No</th>
          <th>Start Location</th>
          <th>End Location</th>
          <th>District HQ</th>
          <th>Start to End Distance (km)</th>
          <th>HQ to End Distance (km)</th>
        </tr>
      </thead>
      <tbody>
        <!-- Entries will be added here -->
      </tbody>
    </table>
    <div class="ranking-controls">
      <button id="showRankings">Show Rankings</button>
      <select id="rankingCriteria">
        <option value="startToEnd">Start to End</option>
        <option value="hqToEnd">HQ to End</option>
      </select>
    </div>
  </div>

  <div class="modal" id="resultModal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <h2>Distance and Duration</h2>
      <p id="startToEndDistance"></p>
      <p id="startToEndDuration"></p>
      <p id="hqToEndDistance"></p>
      <p id="hqToEndDuration"></p>
    </div>
  </div>

  <footer class="footer">
    <p>&copy; 2024 Saketh Pinumalla. All rights reserved.</p>
  </footer>

  <script>
    const entries = [];

document.getElementById('getDistances').addEventListener('click', async function() {
  const startLocation = document.getElementById('startLocation').value + ', India';
  const endLocation = document.getElementById('endLocation').value + ', India';
  const hqLocation = document.getElementById('hqLocation').value + ', India';

  const response = await fetch('/api/get-distances', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ startLocation, endLocation, hqLocation }),
  });

  const data = await response.json();

  document.getElementById('startToEndDistance').innerText = `Distance from Start to End: ${data.startToEnd.distanceKm} km`;
  document.getElementById('startToEndDuration').innerText = `Duration from Start to End: ${data.startToEnd.durationMinutes} minutes`;
  document.getElementById('hqToEndDistance').innerText = `Distance from District HQ to End: ${data.hqToEnd.distanceKm} km`;
  document.getElementById('hqToEndDuration').innerText = `Duration from District HQ to End: ${data.hqToEnd.durationMinutes} minutes`;

  document.getElementById('resultModal').style.display = 'flex';
});

document.getElementById('addToList').addEventListener('click', async function() {
  const startLocation = document.getElementById('startLocation').value + ', India';
  const endLocation = document.getElementById('endLocation').value + ', India';
  const hqLocation = document.getElementById('hqLocation').value + ', India';

  try {
    const response = await fetch('/api/get-distances', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ startLocation, endLocation, hqLocation }),
    });

    if (!response.ok) {
      throw new Error(`API error: ${response.status} ${response.statusText}`);
    }

    const data = await response.json();

    entries.push({
      startLocation: document.getElementById('startLocation').value,
      endLocation: document.getElementById('endLocation').value,
      hqLocation: document.getElementById('hqLocation').value,
      startToEndDistance: parseFloat(data.startToEnd.distanceKm),
      hqToEndDistance: parseFloat(data.hqToEnd.distanceKm),
    });

    updateTable();
  } catch (error) {
    console.error('Error in API call:', error);
    alert('Failed to calculate distances. Please try again.');
  }
});

document.getElementById('showRankings').addEventListener('click', function() {
  const criteria = document.getElementById('rankingCriteria').value;
  const sortedEntries = [...entries].sort((a, b) => {
    if (criteria === 'startToEnd') {
      return a.startToEndDistance - b.startToEndDistance;
    } else {
      return a.hqToEndDistance - b.hqToEndDistance;
    }
  });
  updateTable(sortedEntries);
});

function updateTable(entriesToShow = entries) {
  const tbody = document.querySelector('#locationTable tbody');
  tbody.innerHTML = '';
  entriesToShow.forEach((entry, index) => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${index + 1}</td>
      <td>${entry.startLocation}</td>
      <td>${entry.endLocation}</td>
      <td>${entry.hqLocation}</td>
      <td>${entry.startToEndDistance} km</td>
      <td>${entry.hqToEndDistance} km</td>
    `;
    tbody.appendChild(row);
  });
}

document.getElementById('closeModal').addEventListener('click', function() {
  document.getElementById('resultModal').style.display = 'none';
});

window.onclick = function(event) {
  if (event.target === document.getElementById('resultModal')) {
    document.getElementById('resultModal').style.display = 'none';
  }
}

  </script>
</body>
</html>
